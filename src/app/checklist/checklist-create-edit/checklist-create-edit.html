<div class="checklist-form-page">
  <div class="form-container">
    <h2 class="form-title">
      {{ isEditing ? 'Editar Checklist' : 'Crear Nueva Checklist' }}
    </h2>

    @if (errorMessage) {
      <div class="alert-error">{{ errorMessage }}</div>
    }

    <form [formGroup]="checklistForm" (ngSubmit)="onSubmit()">
      
      @if (!isEditing) {
        <div class="form-group">
          <label class="field-label">Seleccioná el viaje asociado:</label>

          @if (userTrips().loading) {
            <p class="loading-trips">Cargando tus viajes...</p>
          } 
          @else if (userTrips().list.length === 0) {
            <p class="no-trips-msg">
              No tenés viajes creados todavía. Creá un viaje para asociarlo a esta checklist.
            </p>
          } 
          @else {
            <div class="trip-grid">
              @for (trip of userTrips().list; track trip.id) {
                <div
                  class="trip-card"
                  [class.selected]="isSelected(trip.id)"
                  (click)="selectTrip(trip.id)"
                >
                  <h4 class="trip-name">{{ trip.name }}</h4>
                  <p class="trip-destination">
                    <strong>Destino:</strong> {{ trip.destination }}
                  </p>
                  <p class="trip-dates">
                    <span><strong>Inicio:</strong> {{ trip.startDate }}</span>
                    <span><strong>Fin:</strong> {{ trip.endDate }}</span>
                  </p>
                </div>
              }
            </div>
          }

          @if (checklistForm.get('tripId')?.invalid && checklistForm.get('tripId')?.touched) {
            <div class="validation-error">Debes seleccionar un viaje.</div>
          }
        </div>
      }

      <div class="form-group">
        <label for="name" class="field-label">Nombre de la checklist:</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="Ej: Preparativos de viaje"
          class="text-input"
        />

        @if (checklistForm.get('name')?.invalid && checklistForm.get('name')?.touched) {
          <div class="validation-error">
            @if (checklistForm.get('name')?.errors?.['required']) {
              <p>El nombre es obligatorio.</p>
            }
            @if (checklistForm.get('name')?.errors?.['maxlength']) {
              <p>El nombre no puede superar los 50 caracteres.</p>
            }
          </div>
        }
      </div>

      <div class="form-actions">
        <button
          type="submit"
          [disabled]="checklistForm.invalid || loading"
          class="btn-primary"
        >
          @if (loading) {
            Guardando...
          } @else {
            {{ isEditing ? 'Actualizar' : 'Crear Checklist' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>
