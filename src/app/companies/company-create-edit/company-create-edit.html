@if (mode) {
<div class="company-form-container">
  
  <header class="form-header">
    <h1 class="text">
      @if (mode === 'create') {
        Registro de Nueva Compañía
      } @else {
        Editar Perfil de Compañía (Admin)
      }
    </h1>
    <p class="text">
      @if (mode === 'create') {
        Completa los detalles para crear una nueva cuenta de empresa.
      } @else {
        Actualiza la información de la compañía seleccionada.
      }
    </p>
  </header>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="form">
   
    @if (errorMessage) {
      <div class="alert-error" role="alert">
        {{ errorMessage }}
      </div>
    }

    <div class="form-things">
      
      <div class="form-group">
        <label for="username">Nombre de Usuario</label>
        <input id="username" type="text" formControlName="username" placeholder="Nombre único de la empresa">
        @if (profileForm.get('username')?.touched && profileForm.get('username')?.hasError('required')) {
          <p class="error-message">El nombre de usuario es obligatorio.</p>
        } @else if (profileForm.get('username')?.touched && (profileForm.get('username')?.hasError('minlength') || profileForm.get('username')?.hasError('maxlength'))) {
          <p class="error-message">Debe tener entre 5 y 20 caracteres.</p>
        }
      </div>

      <div class="form-group">
        <label for="email">Email de Contacto</label>
        <input id="email" type="email" formControlName="email" placeholder="contacto@empresa.com">
        @if (profileForm.get('email')?.touched && profileForm.get('email')?.hasError('required')) {
          <p class="error-message">El email es obligatorio.</p>
        } @else if (profileForm.get('email')?.touched && profileForm.get('email')?.hasError('email')) {
          <p class="error-message">El formato del email no es válido.</p>
        }
      </div>

      <div class="form-group">
        <label for="taxId">ID Fiscal / CIF / RUC</label>
        <input id="taxId" type="text" formControlName="taxId" placeholder="Ej: 11 dígitos numéricos">
        @if (profileForm.get('taxId')?.touched && profileForm.get('taxId')?.hasError('required')) {
          <p class="error-message">El ID fiscal es obligatorio.</p>
        } @else if (profileForm.get('taxId')?.touched && profileForm.get('taxId')?.hasError('pattern')) {
          <p class="error-message">Formato de ID fiscal inválido (deben ser 11 dígitos numéricos).</p>
        }
      </div>

      <div class="form-group">
        <label for="phone">Teléfono de Contacto</label>
        <input id="phone" type="tel" formControlName="phone" placeholder="+54911...">
        @if (profileForm.get('phone')?.touched && profileForm.get('phone')?.hasError('required')) {
          <p class="error-message">El teléfono es obligatorio.</p>
        } @else if (profileForm.get('phone')?.touched && profileForm.get('phone')?.hasError('pattern')) {
          <p class="error-message">Formato de teléfono inválido (ej: +549...).</p>
        }
      </div>
    </div>

    <div class="grid grid-cols-1 gap-6">
      
      <div class="form-group">
        <label for="location">Ubicación / Dirección Principal</label>
        <input id="location" type="text" formControlName="location" placeholder="Ciudad, País o Dirección completa">
        @if (profileForm.get('location')?.touched && profileForm.get('location')?.hasError('required')) {
          <p class="error-message">La ubicación es obligatoria.</p>
        }
      </div>

      <div class="form-group">
        <label for="description">Descripción de la Compañía (Servicios)</label>
        <textarea id="description" formControlName="description" rows="3" placeholder="Describe brevemente los servicios y actividades principales."></textarea>
        @if (profileForm.get('description')?.touched && profileForm.get('description')?.hasError('required')) {
          <p class="error-message">La descripción es obligatoria.</p>
        }
      </div>
    </div>

    @if (mode === 'create') {
      <div class="password-fields">
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input id="password" type="password" formControlName="password" placeholder="Mínimo 8 caracteres">
          @if (profileForm.get('password')?.touched && profileForm.get('password')?.hasError('required')) {
            <p class="error-message">La contraseña es obligatoria.</p>
          } @else if (profileForm.get('password')?.touched && profileForm.get('password')?.hasError('strongPassword')) {
            <p class="error-message">La contraseña debe ser fuerte (mayúscula, minúscula, número, símbolo).</p>
          }
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirmar Contraseña</label>
          <input id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="Repetir contraseña">
          @if (profileForm.hasError('match') && profileForm.get('confirmPassword')?.touched) {
            <p class="error-message">Las contraseñas no coinciden.</p>
          }
        </div>
      </div>
    } @else {
      <div class="password-fields">
        <p class="text-sm text-gray-500 mb-2">Deja los campos de contraseña vacíos si no deseas cambiarlas.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-group">
            <label for="password">Nueva Contraseña (Opcional)</label>
            <input id="password" type="password" formControlName="password" placeholder="Mínimo 8 caracteres">
             @if (profileForm.get('password')?.touched && profileForm.get('password')?.value && profileForm.get('password')?.hasError('strongPassword')) {
                <p class="error-message">La contraseña debe ser fuerte (mayúscula, minúscula, número, símbolo).</p>
            }
          </div>
          <div class="form-group">
            <label for="confirmPassword">Confirmar Nueva Contraseña</label>
            <input id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="Repetir nueva contraseña">
            @if (profileForm.hasError('match') && (profileForm.get('password')?.value || profileForm.get('confirmPassword')?.value)) {
              <p class="error-message">Las contraseñas no coinciden.</p>
            }
          </div>
        </div>
      </div>
    }

    <div class="actions">
      <button type="submit" [disabled]="profileForm.invalid || loading" class="submit-button">
        @if (loading) {
          Guardando...
        } @else {
          @if (mode === 'create') {
            Registrar Compañía
          } @else {
            Guardar Cambios
          }
        }
      </button>
    </div>

  </form>
</div>
}